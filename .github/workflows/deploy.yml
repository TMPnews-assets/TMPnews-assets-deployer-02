name: Deploy to Cloudflare Pages

on:
  # Listens for the signal from your Termux script
  repository_dispatch:
    types: [deploy_assets]
  # Allows manual run from GitHub Actions tab
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Public Repo
        uses: actions/checkout@v4

      - name: Clone Private Assets (CORRECTED)
        run: |
          git clone https://${{ secrets.READ_PRIVATE_PAT }}@github.com/${{ github.repository_owner }}/TMPnews-assets-02.git tmp_assets

      - name: Install Wrangler CLI
        run: npm install -g wrangler

      - name: Deploy to Cloudflare Pages
        # This uploads the 'Public' folder. 
        # Since your script saves to 'Public/images', your URL will be assets.tmpnews.com/images/filename.webp
        run: |
          wrangler pages deploy ./tmp_assets/Public \
            --project-name=${{ secrets.WRANGLER_PROJECT_NAME }} \
            --branch=main
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
